<!DOCTYPE html>
<html>
  <head>
    <style>
      #merlin {
        width: 100px;
        height: 160px;
        image-rendering: pixelated;
      }

      #cow,
      #bear {
        width: 120px;
        height: 120px;
        image-rendering: pixelated;
      }
    </style>
  </head>
  <body>
    <div style="display: flex; flex-direction: row">
      <canvas id="mainRoom" width="400" height="300"></canvas>

      <canvas id="bear" width="40" height="40"></canvas>
      <canvas id="cow" width="40" height="40"></canvas>

      <canvas id="merlin" width="25" height="40"></canvas>
    </div>

    <script>
      var canvas = document.getElementById("mainRoom");
      var ctx = canvas.getContext("2d");

      const merlinCtx = document.getElementById("merlin").getContext("2d");
      const merlinImage = new Image();
      merlinImage.onload = () => {
        merlinCtx.drawImage(merlinImage, 0, 0);
        ctx.drawImage(document.getElementById("merlin"), 200, 200);
        window.requestAnimationFrame(gameLoop);
      };
      merlinImage.src = "merlin-001-25x40.png";

      const cowCtx = document.getElementById("cow").getContext("2d");
      const cowImage = new Image();
      cowImage.onload = () => {
        cowCtx.drawImage(cowImage, 0, 0);
        ctx.drawImage(document.getElementById("cow"), 0, 25);
      };
      cowImage.src = "cow-jumps-moon-sm.png";

      const bearCtx = document.getElementById("bear").getContext("2d");
      const bearsImage = new Image();
      bearsImage.onload = () => {
        bearCtx.drawImage(bearsImage, 0, 0);
        ctx.drawImage(document.getElementById("bear"), 100, 200);
      };
      bearsImage.src = "three-bears-sm.png";

      /////

      let keyPresses = {};
      let positionX = 0;
      let positionY = 0;
      let MOVEMENT_SPEED = 1;

      window.addEventListener("keydown", (e) => move(e, "down"), false);
      window.addEventListener("keyup", (e) => move(e, "up"), false);

      function move(e, dir) {
        console.log("press ", e.key, dir);
        switch (e.keyCode) {
          case 37:
            keyPresses[e.key] = Boolean(dir);
            // left key pressed
            break;
          case 38:
            keyPresses[e.key] = Boolean(dir);
            // up key pressed
            break;
          case 39:
            keyPresses[e.key] = Boolean(dir);
            // right key pressed
            break;
          case 40:
            keyPresses[e.key] = Boolean(dir);
            // down key pressed
            break;
        }
      }

      function gameLoop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "green";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        if (keyPresses.ArrowUp) {
          positionY -= MOVEMENT_SPEED;
        } else if (keyPresses.ArrowDown) {
          positionY += MOVEMENT_SPEED;
        }
        if (keyPresses.ArrowLeft) {
          positionX -= MOVEMENT_SPEED;
        } else if (keyPresses.ArrowRight) {
          positionX += MOVEMENT_SPEED;
        }

        drawFrame(positionX, positionY);
        window.requestAnimationFrame(gameLoop);
      }

      function drawFrame(canvasX, canvasY) {
        ctx.drawImage(document.getElementById("merlin"), positionX, positionY);
        //   ctx.drawImage(img,
        //                 frameX * WIDTH, frameY * HEIGHT, WIDTH, HEIGHT,
        //                 canvasX, canvasY, SCALED_WIDTH, SCALED_HEIGHT);
      }

      // https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Using_images
      class Game {
        constructor() {
          this.keyPresses = {};

          this.positionX = 10;
          this.positionY = 10;
        }

        functioninit() {
          window.addEventListener(
            "keydown",
            (e) => this.move(e, "down"),
            false
          );
          window.addEventListener("keyup", (e) => this.move(e, "up"), false);

          //   ctx.drawImage(document.getElementById("cow"),59, 10);
          //   ctx.drawImage(document.getElementById("bear"),-100, 50);

          this.gameLoop();
        }

        gameLoop() {
          console.log("start loop");
          console.log(this.keyPresses);
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          if (this.keyPresses.arrowDown) {
            this.positionY -= this.MOVEMENT_SPEED;
          } else if (this.keyPresses.arrowUp) {
            this.positionY += this.MOVEMENT_SPEED;
          }
          if (this.keyPresses.arrowLeft) {
            this.positionX -= this.MOVEMENT_SPEED;
          } else if (this.keyPresses.arrowRight) {
            this.positionX += this.MOVEMENT_SPEED;
          }

          this.drawMerlin(this.positionX, this.positionY);

          window.requestAnimationFrame(this.gameLoop);
        }

        drawMerlin(posX, posY) {
          ctx.drawImage(document.getElementById("merlin"), posX, posY);
        }

        move(e, dir) {
          console.log("press key ", dir);
          switch (e.keyCode) {
            case 37:
              this.keyPresses[e.key] = Boolean(dir);
              // left key pressed
              break;
            case 38:
              this.keyPresses[e.key] = Boolean(dir);
              // up key pressed
              break;
            case 39:
              this.keyPresses[e.key] = Boolean(dir);
              // right key pressed
              break;
            case 40:
              this.keyPresses[e.key] = Boolean(dir);
              // down key pressed
              break;
          }
        }
      }

      //   window.Game = Game;

      //   var game = new Game();

      //   game.init();
    </script>
  </body>
</html>
